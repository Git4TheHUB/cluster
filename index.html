<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>iOS Cardboard VR - Rear Camera with Fun Filters & Zoom</title>
    <style>
        body { margin: 0; overflow: hidden; background: black; }
        #container {
            position: absolute;
            width: 100%; height: 100%;
            perspective: 800px;
        }
        .eye {
            position: absolute;
            width: 50%; height: 100%;
            overflow: hidden;
            transform-style: preserve-3d;
        }
        #leftEye { left: 0; }
        #rightEye { right: 0; }
        video {
            position: absolute;
            top: 50%; left: 50%;
            width: 100%; height: 100%;
            object-fit: contain;
            transform: translate(-50%, -50%);
            transition: transform 0.1s ease-out, filter 0.4s ease;
            background: black;
        }
        #startButton {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 20px 40px; font-size: 24px; background: rgba(0,0,0,0.7); color: white;
            border: 2px solid white; border-radius: 10px; z-index: 20;
        }
        .lens {
            position: absolute;
            width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 25%, rgba(0,0,0,0.8) 85%);
            pointer-events: none;
        }

        /* Corner tap zones */
        .corner-tap {
            position: absolute;
            width: 150px;
            height: 150px;
            z-index: 20;
        }
        #topLeft { top: 0; left: 0; }
        #topRight { top: 0; right: 0; }
        #bottomLeft { bottom: 0; left: 0; }
        #bottomRight { bottom: 0; right: 0; }

        /* Expanded menu with fun filters */
        #controlMenu {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            padding: 30px 35px;
            border-radius: 25px;
            z-index: 30;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s;
            text-align: center;
            color: white;
            font-family: -apple-system, sans-serif;
            max-width: 95%;
            box-sizing: border-box;
        }
        #controlMenu.visible {
            opacity: 1;
            visibility: visible;
        }

        .section {
            margin-bottom: 30px;
        }
        label {
            display: block;
            margin-bottom: 12px;
            font-size: 22px;
            font-weight: bold;
        }
        #zoomSlider {
            width: 380px;
            max-width: 90vw;
            height: 12px;
            border-radius: 6px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }
        #zoomSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 0 15px rgba(255,255,255,0.6);
        }
        #zoomValue {
            margin-top: 10px;
            font-size: 20px;
        }

        /* Fun filter buttons */
        #filterButtons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
        }
        .filter-btn {
            padding: 14px 22px;
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            font-size: 18px;
            min-width: 110px;
            transition: all 0.3s;
        }
        .filter-btn.active {
            background: rgba(255,255,255,0.5);
            border-color: white;
            box-shadow: 0 0 15px rgba(255,255,255,0.7);
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="leftEye" class="eye">
            <video id="videoLeft" autoplay playsinline muted></video>
            <div class="lens"></div>
        </div>
        <div id="rightEye" class="eye">
            <video id="videoRight" autoplay playsinline muted></video>
            <div class="lens"></div>
        </div>
    </div>

    <div class="corner-tap" id="topLeft"></div>
    <div class="corner-tap" id="topRight"></div>
    <div class="corner-tap" id="bottomLeft"></div>
    <div class="corner-tap" id="bottomRight"></div>

    <!-- Menu with zoom + fun filters -->
    <div id="controlMenu">
        <div class="section">
            <label>Field of View</label>
            <input type="range" id="zoomSlider" min="1.0" max="4.0" step="0.05" value="2.0">
            <div id="zoomValue">FOV: Normal</div>
        </div>

        <div class="section">
            <label>Fun Filters ðŸŽ‰</label>
            <div id="filterButtons">
                <button class="filter-btn active" data-filter="none">Normal</button>
                <button class="filter-btn" data-filter="neon">Neon Glow</button>
                <button class="filter-btn" data-filter="pop3d">Pop 3D</button>
                <button class="filter-btn" data-filter="thermal">Thermal Vision</button>
                <button class="filter-btn" data-filter="glitch">Glitch</button>
                <button class="filter-btn" data-filter="rainbow">Rainbow</button>
                <button class="filter-btn" data-filter="night">Night Vision</button>
                <button class="filter-btn" data-filter="vibrant">Vibrant</button>
            </div>
        </div>
    </div>

    <button id="startButton">Tap to Start Rear Camera</button>

    <script>
        const videoLeft = document.getElementById('videoLeft');
        const videoRight = document.getElementById('videoRight');
        const startButton = document.getElementById('startButton');
        const controlMenu = document.getElementById('controlMenu');
        const zoomSlider = document.getElementById('zoomSlider');
        const zoomValue = document.getElementById('zoomValue');
        const filterButtons = document.querySelectorAll('.filter-btn');

        const cornerTaps = document.querySelectorAll('.corner-tap');

        let currentScale = 2.0;
        let currentFilter = 'none';

        const filters = {
            none: 'none',
            neon: 'brightness(1.3) contrast(1.5) saturate(2) hue-rotate(180deg) drop-shadow(0 0 10px cyan)',
            pop3d: 'contrast(180%) saturate(160%) brightness(1.1) drop-shadow(4px 4px 8px rgba(255,255,255,0.8)) drop-shadow(-4px -4px 8px rgba(0,200,255,0.8))',
            thermal: 'sepia(100%) hue-rotate(180deg) invert(100%) brightness(1.2)',
            glitch: 'hue-rotate(90deg) saturate(300%) contrast(200%)',
            rainbow: 'hue-rotate(0deg) saturate(300%) brightness(1.2)',
            night: 'brightness(0.8) contrast(1.5) sepia(30%) hue-rotate(120deg)',
            vibrant: 'saturate(200%) contrast(140%) brightness(110%)'
        };

        // Rainbow animation
        let hue = 0;
        setInterval(() => {
            if (currentFilter === 'rainbow') {
                hue = (hue + 2) % 360;
                const rainbowFilter = `hue-rotate(${hue}deg) saturate(300%) brightness(1.2)`;
                videoLeft.style.filter = rainbowFilter;
                videoRight.style.filter = rainbowFilter;
            }
        }, 50);

        function updateView() {
            const scale = `scale(${currentScale})`;
            let filter = filters[currentFilter];

            if (currentFilter === 'rainbow') {
                filter = `hue-rotate(0deg) saturate(300%) brightness(1.2)`;
            }

            const transform = `translate(-50%, -50%) ${scale}`;
            videoLeft.style.transform = transform;
            videoRight.style.transform = transform;

            videoLeft.style.filter = filter;
            videoRight.style.filter = filter;

            // Update FOV text
            if (currentScale < 1.3) zoomValue.textContent = "FOV: Very Wide";
            else if (currentScale < 1.7) zoomValue.textContent = "FOV: Wide";
            else if (currentScale < 2.3) zoomValue.textContent = "FOV: Normal";
            else zoomValue.textContent = "FOV: Narrow";
        }

        function toggleMenu() {
            controlMenu.classList.toggle('visible');
        }

        cornerTaps.forEach(corner => {
            corner.addEventListener('touchend', (e) => {
                e.preventDefault();
                toggleMenu();
            });
        });

        zoomSlider.addEventListener('input', () => {
            currentScale = parseFloat(zoomSlider.value);
            updateView();
        });

        filterButtons.forEach(btn => {
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                filterButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                updateView();
            });
        });

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: "environment",
                        width: { ideal: 4096 },
                        height: { ideal: 3072 }
                    }
                });

                videoLeft.srcObject = stream;
                videoRight.srcObject = stream;

                await videoLeft.play();
                await videoRight.play();

                startButton.style.display = 'none';
                document.body.requestFullscreen?.();

                updateView();

            } catch (err) {
                startButton.textContent = "Error: " + err.message;
                console.error(err);
            }
        }

        startButton.addEventListener('click', startCamera);

        document.addEventListener('touchstart', function reqFS() {
            document.body.requestFullscreen?.();
            document.removeEventListener('touchstart', reqFS);
        });
    </script>
</body>
</html>
